<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Garrett Grolemund">
<title>10&nbsp; Velocidad – Programación práctica con R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./a1-starting.html" rel="next">
<link href="./loops.html" rel="prev">
<link href="./projectlogo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5fd9db47a040b21ac2cac9a0b3b722ba.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script><meta name="google-site-verification" content="kphyQu6n4JhBUuoLZxnJpD9dbw9q5FLwqXb9AkI2fhU">
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./slots.html">Proyecto 3: Máquina Tragamonedas</a></li><li class="breadcrumb-item"><a href="./speed.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Velocidad</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Buscar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Programación práctica con R</a> 
        <div class="sidebar-tools-main">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/rstudio-education/hopr">
            Original
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/davidrsch/hopres">
            Traducción
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Alternar modo lector">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bienvenido</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefacio</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./dice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Proyecto 1: Dados Ponderados</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Lo Más Básico</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Paquetes y páginas de ayuda</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./cards.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Proyecto 2: Baraja de Cartas</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./objects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Objectos de R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Notación de R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modifying.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Modificación de Valores</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./environments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Entornos</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./slots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Proyecto 3: Máquina Tragamonedas</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Programas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./s3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">S3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./loops.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Bucles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./speed.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Velocidad</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Apéndices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Alternar sección">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./a1-starting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Instalación de R y RStudio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./a2-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Paquetes de R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./a3-updating.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Actualizando R y sus Paquetes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./a4-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Cargar y Guardar Datos en R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./a5-debug.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Depuración de Código de R</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
<li><a href="#c%C3%B3digo-vectorizado" id="toc-código-vectorizado" class="nav-link active" data-scroll-target="#c%C3%B3digo-vectorizado"><span class="header-section-number">10.1</span> Código Vectorizado</a></li>
  <li><a href="#c%C3%B3mo-escribir-c%C3%B3digo-vectorizado" id="toc-cómo-escribir-código-vectorizado" class="nav-link" data-scroll-target="#c%C3%B3mo-escribir-c%C3%B3digo-vectorizado"><span class="header-section-number">10.2</span> Cómo Escribir Código Vectorizado</a></li>
  <li><a href="#c%C3%B3mo-escribir-bucles-for-r%C3%A1pidos-en-r" id="toc-cómo-escribir-bucles-for-rápidos-en-r" class="nav-link" data-scroll-target="#c%C3%B3mo-escribir-bucles-for-r%C3%A1pidos-en-r"><span class="header-section-number">10.3</span> Cómo Escribir Bucles for Rápidos en R</a></li>
  <li>
<a href="#c%C3%B3digo-vectorizado-en-la-pr%C3%A1ctica" id="toc-código-vectorizado-en-la-práctica" class="nav-link" data-scroll-target="#c%C3%B3digo-vectorizado-en-la-pr%C3%A1ctica"><span class="header-section-number">10.4</span> Código Vectorizado en la Práctica</a>
  <ul class="collapse">
<li><a href="#bucles-vs-c%C3%B3digo-vectorizado" id="toc-bucles-vs-código-vectorizado" class="nav-link" data-scroll-target="#bucles-vs-c%C3%B3digo-vectorizado"><span class="header-section-number">10.4.1</span> Bucles vs Código Vectorizado</a></li>
  </ul>
</li>
  <li><a href="#resumen" id="toc-resumen" class="nav-link" data-scroll-target="#resumen"><span class="header-section-number">10.5</span> Resumen</a></li>
  <li><a href="#resumen-del-proyecto-3" id="toc-resumen-del-proyecto-3" class="nav-link" data-scroll-target="#resumen-del-proyecto-3"><span class="header-section-number">10.6</span> Resumen del Proyecto 3</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./slots.html">Proyecto 3: Máquina Tragamonedas</a></li><li class="breadcrumb-item"><a href="./speed.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Velocidad</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="speed" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Velocidad</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>Como científico de datos, necesita velocidad. Puede trabajar con datos más grandes y realizar tareas más ambiciosas cuando su código se ejecuta rápidamente. Este capítulo le mostrará una forma específica de escribir código rápido en R. Luego usará el método para simular 10 millones de juegos de su máquina tragamonedas.</p>
<section id="código-vectorizado" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="código-vectorizado">
<span class="header-section-number">10.1</span> Código Vectorizado</h2>
<p>Puede escribir una pieza de código de muchas maneras diferentes, pero el código R más rápido generalmente aprovechará tres cosas: pruebas lógicas, creación de subconjuntos y ejecución de elementos. Estas son las cosas que R hace mejor. El código que usa estas cosas suele tener una cierta cualidad: está <em>vectorizado</em>; el código puede tomar un vector de valores como entrada y manipular cada valor en el vector al mismo tiempo.</p>
<p>Para ver cómo se ve el código vectorizado, compare estos dos ejemplos de una función de valor absoluto. Cada uno toma un vector de números y lo transforma en un vector de valores absolutos (por ejemplo, números positivos). El primer ejemplo no está vectorizado; <code>abs_bucle</code> usa un bucle <code>for</code> para manipular cada elemento del vector uno a la vez:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">abs_bucle</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vec</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">vec</span></span>
<span><span class="op">}</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>El segundo ejemplo, <code>abs_set</code>, es una versión vectorizada de <code>abs_bucle</code>. Utiliza subconjuntos lógicos para manipular todos los números negativos en el vector al mismo tiempo:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">abs_sets</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vec</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">negs</span> <span class="op">&lt;-</span> <span class="va">vec</span> <span class="op">&lt;</span> <span class="fl">0</span></span>
<span>  <span class="va">vec</span><span class="op">[</span><span class="va">negs</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">vec</span><span class="op">[</span><span class="va">negs</span><span class="op">]</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span></span>
<span>  <span class="va">vec</span></span>
<span><span class="op">}</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>abs_set</code> es mucho más rápido que <code>abs_bucle</code> porque se basa en operaciones que R realiza rápidamente: pruebas lógicas, creación de subconjuntos y ejecución de elementos.</p>
<p>Puedes usar la función <code>system.time</code> para ver qué tan rápido es <code>abs_set</code>. <code>system.time</code> toma una expresión R, la ejecuta y luego muestra cuánto tiempo transcurrió mientras se ejecutaba la expresión.</p>
<p>Para comparar <code>abs_bucle</code> y <code>abs_set</code>, primero haga un vector largo de números positivos y negativos. <code>largo</code> contendrá 10 millones de valores:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">largo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">5000000</span><span class="op">)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p><code>rep</code> repite un valor, o vector de valores, muchas veces. Para usar <code>rep</code>, dale un vector de valores y luego el número de veces para repetir el vector. R devolverá los resultados como un nuevo vector más largo.</p>
</div>
</div>
</div>
<p>Luego puede usar <code>system.time</code> para medir cuánto tiempo le toma a cada función evaluar <code>largo</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu">abs_bucle</span><span class="op">(</span><span class="va">largo</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##  15.982   0.032  16.018</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu">abs_sets</span><span class="op">(</span><span class="va">largo</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##   0.529   0.063   0.592</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-simple callout-important">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>No confunda <code>system.time</code> con <code>Sys.time</code>, que devuelve la hora actual.</p>
</div>
</div>
</div>
<p>Las primeras dos columnas de la salida de <code>system.time</code> informan cuántos segundos pasó su computadora ejecutando la llamada en el lado del usuario y en el lado del sistema de su proceso, una dicotomía que variará de un sistema operativo a otro.</p>
<p>La última columna muestra cuántos segundos transcurrieron mientras R ejecutaba la expresión. Los resultados muestran que <code>abs_set</code> calculó el valor absoluto 30 veces más rápido que <code>abs_bucle</code> cuando se aplicó a un vector de 10 millones de números. Puede esperar aceleraciones similares siempre que escriba código vectorizado.</p>
<p><strong>Ejercicio 13.1 (¿Qué tan rápido es abs?)</strong> Muchas funciones de R preexistentes ya están vectorizadas y se han optimizado para funcionar rápidamente. Puede hacer que su código sea más rápido confiando en estas funciones siempre que sea posible. Por ejemplo, R viene con una función de valor absoluto incorporada, <code>abs</code>.</p>
<p>Comprueba cuánto más rápido <code>abs</code> calcula el valor absoluto de <code>long</code> que <code>abs_bucle</code> y <code>abs_set</code>.</p>
<p><em>Solución.</em> Puedes medir la velocidad de <code>abs</code> con <code>system.time</code>. A <code>abs</code> le toma 0,05 segundos, a la velocidad del rayo, calcular el valor absoluto de 10 millones de números. Esto es 0,592 / 0,054 = 10,96 veces más rápido que <code>abs_set</code> y casi 300 veces más rápido que <code>abs_bucle</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">largo</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##   user  system elapsed </span></span>
<span><span class="co">##  0.037   0.018   0.054</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section><section id="cómo-escribir-código-vectorizado" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="cómo-escribir-código-vectorizado">
<span class="header-section-number">10.2</span> Cómo Escribir Código Vectorizado</h2>
<p>El código vectorizado es fácil de escribir en R porque la mayoría de las funciones de R ya están vectorizadas. El código basado en estas funciones se puede vectorizar fácilmente y, por lo tanto, es rápido. Para crear código vectorizado:</p>
<ol type="1">
<li>Use funciones vectorizadas para completar los pasos secuenciales en su programa.</li>
<li>Use subconjuntos lógicos para manejar casos paralelos. Trate de manipular todos los elementos en un caso a la vez.</li>
</ol>
<p><code>abs_bucle</code> y <code>abs_set</code> ilustran estas reglas. Las funciones manejan dos casos y realizan un paso secuencial, Figure <a href="#fig-abs" class="quarto-xref">Figura&nbsp;<span>10.1</span></a>. Si un número es positivo, las funciones lo dejan solo. Si un número es negativo, las funciones lo multiplican por uno negativo.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-abs" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-abs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/hopr_1001.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-abs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;10.1: abs_loop usa un bucle for para clasificar los datos en uno de dos casos: números negativos y números no negativos.
</figcaption></figure>
</div>
</div>
</div>
<p>Puede identificar todos los elementos de un vector que caen en un caso con una prueba lógica. R ejecutará la prueba en forma de elementos y devolverá un <code>TRUE</code> para cada elemento que pertenezca al caso. Por ejemplo, <code>vec &lt; 0</code> identifica cada valor de <code>vec</code> que pertenece al caso negativo. Puede usar la misma prueba lógica para extraer el conjunto de valores negativos con subconjunto lógico:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="op">-</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="op">-</span><span class="fl">6</span>, <span class="fl">7</span>, <span class="op">-</span><span class="fl">8</span>, <span class="fl">9</span>, <span class="op">-</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">vec</span> <span class="op">&lt;</span> <span class="fl">0</span></span>
<span><span class="co">## FALSE TRUE FALSE TRUE FALSE TRUE FALSE TRUE FALSE TRUE</span></span>
<span></span>
<span><span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span><span class="co">## -2  -4  -6  -8 -10</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>El plan de la Figura <a href="#fig-abs" class="quarto-xref">Figura&nbsp;<span>10.1</span></a> ahora requiere un paso secuencial: debe multiplicar cada uno de los valores negativos por uno negativo. Todos los operadores aritméticos de R están vectorizados, por lo que puede usar <code>*</code> para completar este paso de forma vectorizada. <code>*</code> multiplicará cada número en <code>vec[vec &lt; 0]</code> por uno negativo al mismo tiempo:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span></span>
<span><span class="co">## 2  4  6  8 10</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finalmente, puede usar el operador de asignación de R, que también está vectorizado, para guardar el nuevo conjunto sobre el antiguo en el objeto <code>vec</code> original. Dado que <code>&lt;-</code> está vectorizado, los elementos del nuevo conjunto se emparejarán con los elementos del antiguo conjunto, en orden, y luego se realizará la asignación por elementos. Como resultado, cada valor negativo será reemplazado por su pareja positiva, como en la figura <a href="#fig-assignment" class="quarto-xref">Figura&nbsp;<span>10.2</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-assignment" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-assignment-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/hopr_1002.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-assignment-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;10.2: Use subconjuntos lógicos para modificar grupos de valores en su lugar. Los operadores aritméticos y de asignación de R están vectorizados, lo que le permite manipular y actualizar varios valores a la vez.
</figcaption></figure>
</div>
</div>
</div>
<p><strong>Ejercicio 13.2 (Vectorizar una función)</strong> La siguiente función convierte un vector de símbolos de tragamonedas en un vector de nuevos símbolos de tragamonedas. ¿Puedes vectorizarlo? ¿Cuánto más rápido funciona la versión vectorizada?</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cambiar_simbolos</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vec</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"DD"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"comodín"</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"C"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"as"</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"7"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"rey"</span></span>
<span>    <span class="op">}</span><span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"B"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"reina"</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"BB"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"jota"</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"BBB"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"diez"</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"nueve"</span></span>
<span>    <span class="op">}</span> </span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">vec</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DD"</span>, <span class="st">"C"</span>, <span class="st">"7"</span>, <span class="st">"B"</span>, <span class="st">"BB"</span>, <span class="st">"BBB"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cambiar_simbolos</span><span class="op">(</span><span class="va">vec</span><span class="op">)</span></span>
<span><span class="co">##  "comodín" "as"   "rey"  "reina" "jota"  "diez"   "nueve"</span></span>
<span></span>
<span><span class="va">muchas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">vec</span>, <span class="fl">1000000</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu">cambiar_simbolos</span><span class="op">(</span><span class="va">muchas</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##  30.057   0.031  30.079</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><em>Solución.</em> <code>cambiar_simbolos</code> usa un bucle <code>for</code> para clasificar los valores en siete casos diferentes, como se muestra en la Figura <a href="#fig-change" class="quarto-xref">Figura&nbsp;<span>10.3</span></a>.</p>
<p>Para vectorizar <code>cambiar_simbolos</code>, cree una prueba lógica que pueda identificar cada caso:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"DD"</span><span class="op">]</span></span>
<span><span class="co">## "DD"</span></span>
<span></span>
<span><span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"C"</span><span class="op">]</span></span>
<span><span class="co">## "C"</span></span>
<span></span>
<span><span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"7"</span><span class="op">]</span></span>
<span><span class="co">## "7"</span></span>
<span></span>
<span><span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"B"</span><span class="op">]</span></span>
<span><span class="co">## "B"</span></span>
<span></span>
<span><span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"BB"</span><span class="op">]</span></span>
<span><span class="co">## "BB"</span></span>
<span></span>
<span><span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"BBB"</span><span class="op">]</span></span>
<span><span class="co">## "BBB"</span></span>
<span></span>
<span><span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"0"</span><span class="op">]</span></span>
<span><span class="co">## "0"</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-change" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-change-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/hopr_1003.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-change-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;10.3: cambiar_simbolos hace algo diferente para cada uno de los siete casos.
</figcaption></figure>
</div>
</div>
</div>
<p>Luego escribe código que pueda cambiar los símbolos para cada caso:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"DD"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"comodín"</span></span>
<span><span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"C"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"as"</span></span>
<span><span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"7"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"rey"</span></span>
<span><span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"B"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"reina"</span></span>
<span><span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"BB"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"jota"</span></span>
<span><span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"BBB"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"diez"</span></span>
<span><span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"0"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"nueve"</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Cuando combinas esto en una función, tienes una versión vectorizada de <code>cambiar_simbolos</code> que se ejecuta unas 14 veces más rápido:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cambiar_vec</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">vec</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"DD"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"comodín"</span></span>
<span>  <span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"C"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"as"</span></span>
<span>  <span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"7"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"rey"</span></span>
<span>  <span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"B"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"reina"</span></span>
<span>  <span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"BB"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"jota"</span></span>
<span>  <span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"BBB"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"diez"</span></span>
<span>  <span class="va">vec</span><span class="op">[</span><span class="va">vec</span> <span class="op">==</span> <span class="st">"0"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"nueve"</span></span>
<span>  </span>
<span>  <span class="va">vec</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu">cambiar_vec</span><span class="op">(</span><span class="va">muchas</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##   user  system elapsed </span></span>
<span><span class="co">##  1.994   0.059   2.051 </span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>O, mejor aún, use una tabla de búsqueda. Las tablas de búsqueda son un método vectorizado porque se basan en las operaciones de selección vectorizadas de R:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cambiar_vec2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vec</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DD"</span> <span class="op">=</span> <span class="st">"comodín"</span>, <span class="st">"C"</span> <span class="op">=</span> <span class="st">"as"</span>, <span class="st">"7"</span> <span class="op">=</span> <span class="st">"rey"</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="st">"reina"</span>,</span>
<span>    <span class="st">"BB"</span> <span class="op">=</span> <span class="st">"jota"</span>, <span class="st">"BBB"</span> <span class="op">=</span> <span class="st">"diez"</span>, <span class="st">"0"</span> <span class="op">=</span> <span class="st">"nueve"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="va">tb</span><span class="op">[</span><span class="va">vec</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu">cambiar_vec2</span><span class="op">(</span><span class="va">muchas</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##   user  system elapsed </span></span>
<span><span class="co">##  0.687   0.059   0.746 </span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Aquí, una tabla de búsqueda es 40 veces más rápida que la función original.</p>
<p><code>abs_bucle</code> y <code>cambiar_simbolos</code> ilustran una característica del código vectorizado: los programadores a menudo escriben código no vectorizado más lento basándose en bucles <code>for</code> innecesarios, como el de <code>change_simbolos</code>. Creo que esto es el resultado de un malentendido general sobre R. Los bucles <code>for</code> no se comportan de la misma manera en R que en otros lenguajes, lo que significa que debe escribir código en R de manera diferente a como lo haría en otros lenguajes.</p>
<p>Cuando escribe en lenguajes como C y Fortran, debe compilar su código antes de que su computadora pueda ejecutarlo. Este paso de compilación optimiza cómo los bucles <code>for</code> en el código usan la memoria de su computadora, lo que hace que los bucles <code>for</code> sean muy rápidos. Como resultado, muchos programadores usan bucles <code>for</code> con frecuencia cuando escriben en C y Fortran.</p>
<p>Sin embargo, cuando escribe en R, no compila su código. Omite este paso, lo que hace que la programación en R sea una experiencia más fácil de usar. Desafortunadamente, esto también significa que no le da a sus bucles el aumento de velocidad que recibirían en C o Fortran. Como resultado, sus bucles se ejecutarán más lentamente que las otras operaciones que hemos estudiado: pruebas lógicas, creación de subconjuntos y ejecución por elementos. Si puede escribir su código con las operaciones más rápidas en lugar de un bucle <code>for</code>, debe hacerlo. Independientemente del idioma en el que escriba, debe intentar utilizar las funciones del idioma que se ejecute más rápido.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>if y for</strong></p>
<p>Una buena forma de detectar bucles <code>for</code> que podrían vectorizarse es buscar combinaciones de <code>if</code> y <code>for</code>. <code>if</code> solo se puede aplicar a un valor a la vez, lo que significa que a menudo se usa junto con un bucle <code>for</code>. El ciclo <code>for</code> ayuda a aplicar <code>if</code> a un vector completo de valores. Esta combinación generalmente se puede reemplazar con un subconjunto lógico, que hará lo mismo pero se ejecutará mucho más rápido.</p>
</div>
</div>
</div>
<p>Esto no significa que nunca debas usar bucles <code>for</code> en R. Todavía hay muchos lugares en R donde los bucles <code>for</code> tienen sentido. Los bucles <code>for</code> realizan una tarea básica que no siempre se puede recrear con código vectorizado. Los bucles <code>for</code> también son fáciles de entender y se ejecutan razonablemente rápido en R, siempre que tome algunas precauciones.</p>
</section><section id="cómo-escribir-bucles-for-rápidos-en-r" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="cómo-escribir-bucles-for-rápidos-en-r">
<span class="header-section-number">10.3</span> Cómo Escribir Bucles for Rápidos en R</h2>
<p>Puede aumentar drásticamente la velocidad de sus bucles <code>for</code> haciendo dos cosas para optimizar cada bucle. Primero, haz todo lo que puedas fuera del bucle <code>for</code>. Cada línea de código que coloques dentro del bucle <code>for</code> se ejecutará muchas, muchas veces. Si una línea de código solo necesita ejecutarse una vez, colóquela fuera del ciclo para evitar la repetición.</p>
<p>En segundo lugar, asegúrese de que cualquier objeto de almacenamiento que utilice con el ciclo sea lo suficientemente grande como para contener <em>todos</em> los resultados del ciclo. Por ejemplo, ambos bucles a continuación necesitarán almacenar un millón de valores. El primer ciclo almacena sus valores en un objeto llamado <code>salida</code> que comienza con una longitud de <em>un millón</em>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">salida</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1000000</span><span class="op">)</span> </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1000000</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">salida</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">##   user  system elapsed </span></span>
<span><span class="co">##  1.709   0.015   1.724 </span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>El segundo ciclo almacena sus valores en un objeto llamado <code>salida</code> que comienza con una longitud de <em>uno</em>. R expandirá el objeto a una longitud de un millón mientras ejecuta el bucle. El código de este ciclo es muy similar al código del primer ciclo, pero el ciclo tarda <em>37 minutos</em> más en ejecutarse que el primer ciclo:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">salida</span> <span class="op">&lt;-</span> <span class="cn">NA</span> </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1000000</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">salida</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">##     user   system  elapsed </span></span>
<span><span class="co">## 1689.537  560.951 2249.927</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Los dos bucles hacen lo mismo, entonces, ¿qué explica la diferencia? En el segundo bucle, R tiene que aumentar la longitud de <code>salida</code> en uno para cada ejecución del bucle. Para hacer esto, R necesita encontrar un nuevo lugar en la memoria de su computadora que pueda contener el objeto más grande. Luego, R debe copiar el vector <code>salida</code> y borrar la versión anterior de <code>salida</code> antes de pasar a la siguiente ejecución del bucle. Al final del ciclo, R ha reescrito <code>salida</code> en la memoria de su computadora un millón de veces.</p>
<p>En el primer caso, el tamaño de <code>salida</code> nunca cambia; R puede definir un objeto <code>salida</code> en la memoria y usarlo para cada ejecución del bucle <code>for</code>.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Los autores de R usan lenguajes de bajo nivel como C y Fortran para escribir funciones básicas de R, muchas de las cuales usan bucles <code>for</code>. Estas funciones se compilan y optimizan antes de que se conviertan en parte de R, lo que las hace bastante rápidas.</p>
<p>Cada vez que vea <code>.Primitive</code>, <code>.Internal</code> o <code>.Call</code> escrito en la definición de una función, puede estar seguro de que la función está llamando al código de otro idioma. Obtendrá todas las ventajas de velocidad de ese idioma al usar la función.</p>
</div>
</div>
</div>
</section><section id="código-vectorizado-en-la-práctica" class="level2" data-number="10.4"><h2 data-number="10.4" class="anchored" data-anchor-id="código-vectorizado-en-la-práctica">
<span class="header-section-number">10.4</span> Código Vectorizado en la Práctica</h2>
<p>Para ver cómo el código vectorizado puede ayudarlo como científico de datos, considere nuestro proyecto de máquina tragamonedas. En <a href="loops.html">Bucles</a>, calculó la tasa de pago exacta para su máquina tragamonedas, pero podría haber estimado esta tasa de pago con una simulación. Si jugaste a la máquina tragamonedas muchas, muchas veces, el premio promedio de todas las jugadas sería una buena estimación de la verdadera tasa de pago.</p>
<p>Este método de estimación se basa en la ley de los grandes números y es similar a muchas simulaciones estadísticas. Para ejecutar esta simulación, podría usar un bucle <code>for</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ganadas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fl">1000000</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1000000</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ganadas</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">play</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ganadas</span><span class="op">)</span></span>
<span><span class="co">## 0.9366984</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>La tasa de pago estimada después de 10 millones de ejecuciones es 0,937, que está muy cerca de la tasa de pago real de 0,934. Tenga en cuenta que estoy usando la función <code>puntuacion</code> modificada que trata a los diamantes como comodines.</p>
<p>Si ejecuta esta simulación, notará que tarda un tiempo en ejecutarse. De hecho, la simulación tarda 342.308 segundos en ejecutarse, lo que equivale a unos 5,7 minutos. Esto no es particularmente impresionante, y puede hacerlo mejor usando código vectorizado:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1000000</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ganadas</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">play</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">## 342.041   0.355 342.308 </span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>La función <code>puntuacion</code> actual no está vectorizada. Toma una sola combinación de tragamonedas y usa un árbol <code>if</code> para asignarle un premio. Esta combinación de un árbol <code>if</code> con un bucle <code>for</code> sugiere que podrías escribir una pieza de código vectorizado que tome <em>muchas</em> combinaciones de ranuras y luego use subconjuntos lógicos para operar en todas ellas a la vez.</p>
<p>Por ejemplo, podría reescribir <code>obt_simbolos</code> para generar <em>n</em> combinaciones de ranuras y devolverlas como una matriz <em>n</em> x 3, como la siguiente. Cada fila de la matriz contendrá una combinación de espacios para ser puntuada:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">obt_muchos_simbolos</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rueda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DD"</span>, <span class="st">"7"</span>, <span class="st">"BBB"</span>, <span class="st">"BB"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"0"</span><span class="op">)</span></span>
<span>  <span class="va">vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">rueda</span>, size <span class="op">=</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.03</span>, <span class="fl">0.06</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.01</span>, <span class="fl">0.52</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">vec</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">obt_muchos_simbolos</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">##      [,1]  [,2] [,3] </span></span>
<span><span class="co">## [1,] "B"   "0"  "B"  </span></span>
<span><span class="co">## [2,] "0"   "BB" "7"  </span></span>
<span><span class="co">## [3,] "0"   "0"  "BBB"</span></span>
<span><span class="co">## [4,] "0"   "0"  "B"  </span></span>
<span><span class="co">## [5,] "BBB" "0"  "0" </span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>También podría reescribir <code>play</code> para tomar un parámetro, <code>n</code>, y devolver <code>n</code> premios, en un data frame:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">play_muchas</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">simb_mat</span> <span class="op">&lt;-</span> <span class="fu">obt_muchos_simbolos</span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>w1 <span class="op">=</span> <span class="va">simb_mat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, w2 <span class="op">=</span> <span class="va">simb_mat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>             w3 <span class="op">=</span> <span class="va">simb_mat</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>, prize <span class="op">=</span> <span class="fu">puntuacion_muchas</span><span class="op">(</span><span class="va">simb_mat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Esta nueva función facilitaría la simulación de un millón, o incluso 10 millones de jugadas de la máquina tragamonedas, que será nuestro objetivo. Cuando hayamos terminado, podrá estimar la tasa de pago con:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># jugadas &lt;- play_muchas(10000000))</span></span>
<span><span class="co"># mean(jugadas$premio)</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Ahora solo necesitas escribir <code>puntuacion_muchas</code>, una versión vectorizada (¿matrixada?) de <code>puntuacion</code> que toma una matriz <em>n</em> x 3 y devuelve <em>n</em> premios. Será difícil escribir esta función porque <code>puntuacion</code> ya es bastante complicado. No espero que se sienta seguro haciendo esto por su cuenta hasta que tenga más práctica y experiencia de la que hemos podido desarrollar aquí.</p>
<p>Si desea probar sus habilidades y escribir una versión de <code>puntuacio_muchas</code>, le recomiendo que use la función <code>rowSums</code> dentro de su código. Calcula la suma de cada fila de números (o lógicos) en una matriz.</p>
<p>Si desea probarse a sí mismo de una manera más modesta, le recomiendo que estudie el siguiente modelo de función <code>puntuacion_muchas</code> hasta que comprenda cómo funciona cada parte y cómo las partes trabajan juntas para crear una función vectorizada. Para hacer esto, será útil crear un ejemplo concreto, como este:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">simbolos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DD"</span>, <span class="st">"DD"</span>, <span class="st">"DD"</span>, </span>
<span>    <span class="st">"C"</span>, <span class="st">"DD"</span>, <span class="st">"0"</span>, </span>
<span>    <span class="st">"B"</span>, <span class="st">"B"</span>, <span class="st">"B"</span>, </span>
<span>    <span class="st">"B"</span>, <span class="st">"BB"</span>, <span class="st">"BBB"</span>, </span>
<span>    <span class="st">"C"</span>, <span class="st">"C"</span>, <span class="st">"0"</span>, </span>
<span>    <span class="st">"7"</span>, <span class="st">"DD"</span>, <span class="st">"DD"</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">6</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simbolos</span></span>
<span><span class="co">##      [,1] [,2] [,3] </span></span>
<span><span class="co">## [1,] "DD" "DD" "DD" </span></span>
<span><span class="co">## [2,] "C"  "DD" "0"  </span></span>
<span><span class="co">## [3,] "B"  "B"  "B"  </span></span>
<span><span class="co">## [4,] "B"  "BB" "BBB"</span></span>
<span><span class="co">## [5,] "C"  "C"  "0"  </span></span>
<span><span class="co">## [6,] "7"  "DD" "DD" </span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Luego puede ejecutar cada línea de <code>puntuacion_muchas</code> contra el ejemplo y examinar los resultados a medida que avanza.</p>
<p><strong>Ejercicio 13.3 (Pon a Prueba tu Comprensión)</strong> Estudie la función del modelo <code>puntuaciio_muchas</code> hasta que esté satisfecho de que entiende cómo funciona y podría escribir una función similar usted mismo.</p>
<p><strong>Ejercicio 13.4 (Desafío Avanzado)</strong> En lugar de examinar la respuesta modelo, escriba su propia versión vectorizada de <code>puntuacion</code>. Suponga que los datos se almacenan en un <em>n</em> × 3 matriz donde cada fila de la matriz contiene una combinación de ranuras para puntuar.</p>
<p>Puede usar la versión de <code>puntuacion</code> que trata a los diamantes como comodines o la versión de <code>puntuacion</code> que no lo hace. Sin embargo, la respuesta de ejemplo usará la versión que trata a los diamantes como comodines.</p>
<p><em>Solución.</em> <code>puntuacion_muchas</code> es una versión vectorizada de <code>puntuacion</code>. Puede usarlo para ejecutar la simulación al comienzo de esta sección en poco más de 20 segundos. Esto es 17 veces más rápido que usar un bucle <code>for</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># los símbolos deben ser una matriz con una columna para cada ventana de la máquina tragamonedas</span></span>
<span><span class="va">puntuacion_muchas</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">simbolos</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Paso 1: Asigne el premio base basado en cerezas y diamantes ---------</span></span>
<span>  <span class="co">## Cuente el número de cerezas y diamantes en cada combinación.</span></span>
<span>  <span class="va">cerezas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">simbolos</span> <span class="op">==</span> <span class="st">"C"</span><span class="op">)</span></span>
<span>  <span class="va">diamantes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">simbolos</span> <span class="op">==</span> <span class="st">"DD"</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co">## Los diamantes salvajes cuentan como cerezas</span></span>
<span>  <span class="va">premio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span><span class="op">[</span><span class="va">cerezas</span> <span class="op">+</span> <span class="va">diamantes</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co">## ...pero no si hay cero cerezas reales </span></span>
<span>  <span class="co">### (cerezas es forzado a FALSE donde cerezas == 0)</span></span>
<span>  <span class="va">premio</span><span class="op">[</span><span class="op">!</span><span class="va">cerezas</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  </span>
<span>  <span class="co"># Paso 2: Cambie el premio por combinaciones que contengan tríos </span></span>
<span>  <span class="va">iguales</span> <span class="op">&lt;-</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&amp;</span> </span>
<span>    <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="va">pagos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DD"</span> <span class="op">=</span> <span class="fl">100</span>, <span class="st">"7"</span> <span class="op">=</span> <span class="fl">80</span>, <span class="st">"BBB"</span> <span class="op">=</span> <span class="fl">40</span>, </span>
<span>    <span class="st">"BB"</span> <span class="op">=</span> <span class="fl">25</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="fl">10</span>, <span class="st">"C"</span> <span class="op">=</span> <span class="fl">10</span>, <span class="st">"0"</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">premio</span><span class="op">[</span><span class="va">iguales</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pagos</span><span class="op">[</span><span class="va">simbolos</span><span class="op">[</span><span class="va">iguales</span>, <span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Paso 3: Cambia el premio por combinaciones que contengan todas barras ------</span></span>
<span>  <span class="va">barras</span> <span class="op">&lt;-</span> <span class="va">simbolos</span> <span class="op">==</span> <span class="st">"B"</span> <span class="op">|</span> <span class="va">simbolos</span> <span class="op">==</span>  <span class="st">"BB"</span> <span class="op">|</span> <span class="va">simbolos</span> <span class="op">==</span> <span class="st">"BBB"</span></span>
<span>  <span class="va">todas_barras</span> <span class="op">&lt;-</span> <span class="va">barras</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">barras</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">barras</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">iguales</span></span>
<span>  <span class="va">premio</span><span class="op">[</span><span class="va">todas_barras</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span>  </span>
<span>  <span class="co"># Paso 4: Manejar comodines ---------------------------------------------</span></span>
<span>  </span>
<span>  <span class="co">## combos con dos diamantes</span></span>
<span>  <span class="va">dos_salvajes</span> <span class="op">&lt;-</span> <span class="va">diamantes</span> <span class="op">==</span> <span class="fl">2</span></span>
<span></span>
<span>  <span class="co">### Identificar el simbolo no salvaje</span></span>
<span>  <span class="va">uno</span> <span class="op">&lt;-</span> <span class="va">dos_salvajes</span> <span class="op">&amp;</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&amp;</span> </span>
<span>    <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="va">dos</span> <span class="op">&lt;-</span> <span class="va">dos_salvajes</span> <span class="op">&amp;</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">!=</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&amp;</span> </span>
<span>    <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="va">tres</span> <span class="op">&lt;-</span> <span class="va">dos_salvajes</span> <span class="op">&amp;</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&amp;</span> </span>
<span>    <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">!=</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co">### Tratar como tres de una clase</span></span>
<span>  <span class="va">premio</span><span class="op">[</span><span class="va">uno</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pagos</span><span class="op">[</span><span class="va">simbolos</span><span class="op">[</span><span class="va">uno</span>, <span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">premio</span><span class="op">[</span><span class="va">dos</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pagos</span><span class="op">[</span><span class="va">simbolos</span><span class="op">[</span><span class="va">dos</span>, <span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">premio</span><span class="op">[</span><span class="va">tres</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pagos</span><span class="op">[</span><span class="va">simbolos</span><span class="op">[</span><span class="va">tres</span>, <span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co">## combos con un salvaje</span></span>
<span>  <span class="va">un_salvaje</span> <span class="op">&lt;-</span> <span class="va">diamantes</span> <span class="op">==</span> <span class="fl">1</span></span>
<span>  </span>
<span>  <span class="co">### Tratar como todas las barras (si corresponde)</span></span>
<span>  <span class="va">barras_salvajes</span> <span class="op">&lt;-</span> <span class="va">un_salvaje</span> <span class="op">&amp;</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">barras</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">premio</span><span class="op">[</span><span class="va">barras_salvajes</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span>  </span>
<span>  <span class="co">### Tratar como tres de una clase (si corresponde)</span></span>
<span>  <span class="va">uno</span> <span class="op">&lt;-</span> <span class="va">un_salvaje</span> <span class="op">&amp;</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">dos</span> <span class="op">&lt;-</span> <span class="va">un_salvaje</span> <span class="op">&amp;</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">==</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="va">tres</span> <span class="op">&lt;-</span> <span class="va">un_salvaje</span> <span class="op">&amp;</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">==</span> <span class="va">simbolos</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">premio</span><span class="op">[</span><span class="va">uno</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pagos</span><span class="op">[</span><span class="va">simbolos</span><span class="op">[</span><span class="va">uno</span>, <span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">premio</span><span class="op">[</span><span class="va">dos</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pagos</span><span class="op">[</span><span class="va">simbolos</span><span class="op">[</span><span class="va">dos</span>, <span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">premio</span><span class="op">[</span><span class="va">tres</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pagos</span><span class="op">[</span><span class="va">simbolos</span><span class="op">[</span><span class="va">tres</span>, <span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span> </span>
<span>  <span class="co"># Paso 5: Premio doble por cada diamante en combo ------------------</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="va">premio</span> <span class="op">*</span> <span class="fl">2</span><span class="op">^</span><span class="va">diamantes</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu">play_muchas</span><span class="op">(</span><span class="fl">10000000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##   user  system elapsed </span></span>
<span><span class="co">## 20.942   1.433  22.367</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="bucles-vs-código-vectorizado" class="level3" data-number="10.4.1"><h3 data-number="10.4.1" class="anchored" data-anchor-id="bucles-vs-código-vectorizado">
<span class="header-section-number">10.4.1</span> Bucles vs Código Vectorizado</h3>
<p>En muchos idiomas, los bucles <code>for</code> se ejecutan muy rápido. Como resultado, los programadores aprenden a usar bucles <code>for</code> siempre que sea posible cuando codifican. A menudo, estos programadores continúan confiando en los bucles <code>for</code> cuando comienzan a programar en R, normalmente sin tomar los pasos necesarios para optimizar los bucles <code>for</code> de R. Estos programadores pueden desilusionarse con R cuando su código no funciona tan rápido como les gustaría. Si cree que esto le puede estar pasando a usted, examine con qué frecuencia está usando bucles <code>for</code> y para qué los está usando. Si te encuentras usando bucles <code>for</code> para cada tarea, es muy probable que estés “hablando R con acento C”. La cura es aprender a escribir y usar código vectorizado.</p>
<p>Esto no significa que los bucles <code>for</code> no tengan cabida en R. Los bucles <code>for</code> son una característica muy útil; pueden hacer muchas cosas que el código vectorizado no puede hacer. Tampoco debe convertirse en esclavo del código vectorizado. A veces llevaría más tiempo reescribir el código en formato vectorizado que dejar que se ejecute un bucle <code>for</code>. Por ejemplo, ¿sería más rápido dejar que la simulación de tragamonedas se ejecute durante 5,7 minutos o volver a escribir <code>puntuacion</code>?</p>
</section></section><section id="resumen" class="level2" data-number="10.5"><h2 data-number="10.5" class="anchored" data-anchor-id="resumen">
<span class="header-section-number">10.5</span> Resumen</h2>
<p>El código rápido es un componente importante de la ciencia de datos porque puede hacer más con el código rápido que con el código lento. Puede trabajar con conjuntos de datos más grandes antes de que intervengan las restricciones computacionales y puede hacer más cálculos antes de que intervengan las restricciones de tiempo. El código más rápido en R se basará en las cosas que R hace mejor: pruebas lógicas, creación de subconjuntos y ejecución por elementos. He llamado a este tipo de código código vectorizado porque el código escrito con estas operaciones tomará un vector de valores como entrada y operará en cada elemento del vector al mismo tiempo. La mayoría del código escrito en R ya está vectorizado.</p>
<p>Si usa estas operaciones, pero su código no aparece vectorizado, analice los pasos secuenciales y los casos paralelos en su programa. Asegúrese de haber utilizado funciones vectorizadas para manejar los pasos y subconjuntos lógicos para manejar los casos. Tenga en cuenta, sin embargo, que algunas tareas no se pueden vectorizar.</p>
</section><section id="resumen-del-proyecto-3" class="level2" data-number="10.6"><h2 data-number="10.6" class="anchored" data-anchor-id="resumen-del-proyecto-3">
<span class="header-section-number">10.6</span> Resumen del Proyecto 3</h2>
<p>Ahora ha escrito su primer programa en R, y es un programa del que debería estar orgulloso. <code>play</code> no es un simple ejercicio de <code>hola mundo</code>, sino un programa real que realiza una tarea real de una manera complicada.</p>
<p>Escribir nuevos programas en R siempre será un desafío porque la programación depende mucho de su propia creatividad, capacidad de resolución de problemas y experiencia escribiendo tipos de programas similares. Sin embargo, puede usar las sugerencias de este capítulo para hacer que incluso el programa más complicado sea manejable: divida las tareas en pasos y casos simples, trabaje con ejemplos concretos y describa posibles soluciones en español.</p>
<p>Este proyecto completa la educación que comenzaste en <a href="#B%C3%A1sico">Lo Más Básico</a>. Ahora puede usar R para manejar datos, lo que ha aumentado su capacidad para analizar datos. Usted puede:</p>
<ul>
<li>Cargue y almacene datos en su computadora, no en papel o en su mente</li>
<li>Recuerda y cambia con precisión valores individuales sin depender de tu memoria</li>
<li>Indique a su computadora que realice tareas tediosas o complejas en su nombre</li>
</ul>
<p>Estas habilidades resuelven un problema logístico importante al que se enfrenta todo científico de datos: <em>¿cómo puede almacenar y manipular datos sin cometer errores?</em> Sin embargo, este no es el único problema al que se enfrentará como científico de datos. El siguiente problema aparecerá cuando intente comprender la información contenida en sus datos. Es casi imposible detectar ideas o descubrir patrones en datos sin procesar. Aparecerá un tercer problema cuando intente usar su conjunto de datos para razonar sobre la realidad, que incluye cosas que no están contenidas en su conjunto de datos. ¿Qué implican exactamente sus datos sobre cosas fuera del conjunto de datos? ¿Qué tan seguro puedes estar?</p>
<p>Me refiero a estos problemas como problemas logísticos, tácticos y estratégicos de la ciencia de datos, como se muestra en la Figura <a href="#fig-venn" class="quarto-xref">Figura&nbsp;<span>10.4</span></a>. Los enfrentará cada vez que intente aprender de los datos:</p>
<ul>
<li>
<strong>Un problema logístico:</strong> - ¿Cómo puedes almacenar y manipular datos sin cometer errores?</li>
<li>
<strong>Un problema táctico</strong> - ¿Cómo puedes descubrir la información contenida en tus datos?</li>
<li>
<strong>Un problema estratégico</strong> - ¿Cómo puedes usar los datos para sacar conclusiones sobre el mundo en general?</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div id="fig-venn" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-venn-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/hopr_1004.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-venn-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;10.4: Los tres conjuntos de habilidades básicas de la ciencia de datos: programación informática, comprensión de datos y razonamiento científico.
</figcaption></figure>
</div>
</div>
</div>
<p>Un científico de datos completo deberá poder resolver cada uno de estos problemas en muchas situaciones diferentes. Al aprender a programar en R, domina el problema logístico, que es un requisito previo para resolver los problemas tácticos y estratégicos.</p>
<p>Si desea aprender a razonar con datos, o cómo transformar, visualizar y explorar sus conjuntos de datos con herramientas R, le recomiendo el libro <a href="http://r4ds.had.co.nz/"><em>R for Data Science</em></a>, el volumen complementario de este libro. <em>R for Data Science</em> enseña un flujo de trabajo simple para transformar, visualizar y modelar datos en R, así como también cómo informar los resultados con el paquete R Markdown.</p>


</section></main><!-- /main --><script>

  // Chapter name
  const currentChapterFile = window.location.pathname.split('/').pop().replace('.html', '');

  //Deffining urls
  const originalURL = "https://github.com/rstudio-education/hopr";
  const translationURL = "https://github.com/davidrsch/hopres";

  //Deffining texts
  const edit_text = "Editar esta página";
  const issue_text = "Informar de un problema"

  //Deffining git_i
  const git_i = '<div><i class="bi bi-github"></i></div>';

  // Adding TOC if not exist
  const sidebarmargin = document.getElementById('quarto-margin-sidebar');
  const buscar_TOC = document.getElementById('TOC');

  if (!buscar_TOC) {
    const crear_TOC = document.createElement('nav');
    crear_TOC.id = 'TOC';
    crear_TOC.role = "doc-toc";
    crear_TOC.class = "toc-active";
    sidebarmargin.appendChild(crear_TOC);
  }


  // Adding original github actions
  const TOC = document.getElementById('TOC');
  const originalga = document.createElement('h2');
  originalga.textContent = "Original";
  const toc_act_O = document.createElement('div');
  toc_act_O.className = 'toc-actions';
  toc_act_O.id = 'toc-act-O';
  const act_link_O = document.createElement('div');
  act_link_O.className='action-links';
  act_link_O.id='act-link-O';
  const edit_issue_O ='<p><a href="'+originalURL+'/edit/master/'+currentChapterFile+'.rmd" class="toc-action">'+edit_text+'</p><p><a href="'+originalURL+'/issues/new" class="toc-action">'+issue_text+'</p>';


  TOC.appendChild(originalga);
  TOC.appendChild(toc_act_O);
  toc_act_O.innerHTML += git_i;
  toc_act_O.appendChild(act_link_O);
  act_link_O.innerHTML += edit_issue_O;

  // Adding translation github actions
  const translationga = document.createElement('h2');
  translationga.textContent = "Traducción";
  const toc_act_T = document.createElement('div');
  toc_act_T.className = 'toc-actions';
  toc_act_T.id = 'toc-act-T';
  const act_link_T = document.createElement('div');
  act_link_T.className='action-links';
  act_link_T.id='act-link-T';
  const edit_issue_T ='<p><a href="'+translationURL+'/edit/main/'+currentChapterFile+'.qmd" class="toc-action">'+edit_text+'</p><p><a href="'+translationURL+'/issues/new" class="toc-action">'+issue_text+'</p>';


  TOC.appendChild(translationga);
  TOC.appendChild(toc_act_T);
  toc_act_T.innerHTML += git_i;
  toc_act_T.appendChild(act_link_T);
  act_link_T.innerHTML += edit_issue_T;


</script><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copiado");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copiado");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./loops.html" class="pagination-link" aria-label="Bucles">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Bucles</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./a1-starting.html" class="pagination-link" aria-label="Instalación de R y RStudio">
        <span class="nav-page-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Instalación de R y RStudio</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Programación práctica con R fue escrito por Garrett Grolemund.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Este libro fue creado usando <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>